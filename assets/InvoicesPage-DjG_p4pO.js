import{c as P,b as se,r as x,j as e,F as re,T as le,P as de,D as ge,X as G,C as ne,i as ie,s as Q,V as C,d as he,M as be,e as ce,u as ye,a as pe,f as je,g as L,E as fe,h as Ne,k as ke,S as ve}from"./index-D6LT2v2_.js";import{E as we}from"./jspdf.es.min-B8RMXKW2.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=P("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=P("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=P("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=P("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=P("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=P("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=P("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),V=s=>Math.round((s??0)*100)/100;function xe(s){const d=Number(s.quantity||0),r=Number(s.unit_price||0),t=V(d*r);return{...s,line_total:t}}function ee(s){const d=s.items.map(xe),r=V(d.reduce((u,v)=>u+(v.line_total||0),0)),t=Number(s.tax_rate||0),b=Number(s.discount||0),N=V((r-b)*(t/100)),g=V(b),h=V(r-g+N);return{subtotal:r,tax_amount:N,discount_amount:g,total:h}}function te(s){return s.map((d,r)=>{var t;return xe({...d,position:r+1,description:((t=d.description)==null?void 0:t.trim())||"",quantity:Number(d.quantity||0),unit_price:Number(d.unit_price||0)})}).filter(d=>d.description||d.line_total>0)}const Fe=["USD","EUR","CAD","GBP"],Te=["draft","sent","paid","overdue","canceled"],Ae=({isOpen:s,onClose:d,onSuccess:r,invoice:t})=>{se();const[b,N]=x.useState(!1),[g,h]=x.useState(1),[u,v]=x.useState({}),[w,_]=x.useState([]),[f,k]=x.useState(t?[]:[{description:"",quantity:1,unit_price:0}]),[n,c]=x.useState({number:(t==null?void 0:t.number)||"",client_id:(t==null?void 0:t.client_id)||"",currency:(t==null?void 0:t.currency)||"USD",issue_date:(t==null?void 0:t.issue_date)||"",due_date:(t==null?void 0:t.due_date)||"",status:(t==null?void 0:t.status)||"draft",tax_rate:(t==null?void 0:t.tax_rate)??0,discount:(t==null?void 0:t.discount)??0,notes:(t==null?void 0:t.notes)||"",terms:(t==null?void 0:t.terms)||"",tags:(t==null?void 0:t.tags)||[]});x.useEffect(()=>{if(!s)return;(async()=>{if(_([{id:"1",name:"Acme Corp",platform:"Fiverr"},{id:"2",name:"John Doe",platform:"Upwork"}]),t&&ie&&Q){const{data:i,error:a}=await Q.from("invoice_items").select("id,description,quantity,unit_price,position").eq("invoice_id",t.id).order("position");k(a?[{description:"",quantity:1,unit_price:0}]:(i||[]).map(o=>({id:o.id,description:o.description||"",quantity:o.quantity||0,unit_price:o.unit_price||0,position:o.position||0})))}if(!t&&!n.issue_date){const i=new Date,a=i.toISOString().slice(0,10),o=new Date(i.getTime()+7*864e5).toISOString().slice(0,10);c(j=>({...j,issue_date:a,due_date:o}))}})()},[s]);const m=x.useMemo(()=>ee({items:f,tax_rate:Number(n.tax_rate||0),discount:Number(n.discount||0)}),[f,n.tax_rate,n.discount]),S=l=>{const i={};return l===1&&(n.number.trim()||(i.number="Numéro requis"),n.client_id||(i.client_id="Client requis"),n.issue_date||(i.issue_date="Date d’émission requise"),n.due_date||(i.due_date="Échéance requise"),n.issue_date&&n.due_date&&new Date(n.issue_date)>new Date(n.due_date)&&(i.due_date="Échéance doit être après la date d’émission")),l===2&&te(f).length===0&&(i.items="Ajoutez au moins une ligne valide"),l===3&&(Number(n.tax_rate)<0&&(i.tax_rate="Taux invalide"),Number(n.discount)<0&&(i.discount="Remise invalide")),v(i),Object.keys(i).length===0},D=()=>{S(g)&&g<4&&h(i=>i+1)},U=()=>h(l=>Math.max(1,l-1)),A=()=>k(l=>[...l,{description:"",quantity:1,unit_price:0}]),E=l=>k(i=>i.filter((a,o)=>o!==l)),B=l=>k(i=>{if(l<=0)return i;const a=[...i];return[a[l-1],a[l]]=[a[l],a[l-1]],a}),I=l=>k(i=>{if(l>=i.length-1)return i;const a=[...i];return[a[l+1],a[l]]=[a[l],a[l+1]],a}),$=(l,i)=>k(a=>{const o=[...a];return o[l]={...o[l],...i},o}),X=async l=>{l.preventDefault();for(let a=1;a<=3;a++)if(!S(a)){h(a),C.error("Veuillez corriger les erreurs");return}const i=te(f);ee({items:i,tax_rate:Number(n.tax_rate||0),discount:Number(n.discount||0)});{C.success("Simulé (demo): facture enregistrée"),r(),d();return}};if(!s)return null;const y="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent border-gray-300 text-gray-900 placeholder-gray-400 dark:bg-slate-800 dark:border-slate-700 dark:text-white dark:placeholder-slate-400",z="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent border-gray-300 text-gray-900 dark:bg-slate-800 dark:border-slate-700 dark:text-white",p="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",F="mt-1 text-sm text-red-600 flex items-center",J=e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(re,{className:"mr-2",size:20}),"Informations facture"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Numéro *"}),e.jsx("input",{value:n.number,onChange:l=>c({...n,number:l.target.value}),className:`${y} ${u.number?"border-red-300 dark:border-red-500":""}`,placeholder:"INV-2025-0001"}),u.number&&e.jsxs("p",{className:F,children:["⚠️ ",u.number]})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Client *"}),e.jsxs("select",{value:n.client_id,onChange:l=>c({...n,client_id:l.target.value}),className:`${z} ${u.client_id?"border-red-300 dark:border-red-500":""}`,children:[e.jsx("option",{value:"",children:"Sélectionner un client"}),w.map(l=>e.jsxs("option",{value:l.id,children:[l.name," ",l.platform?`(${l.platform})`:""]},l.id))]}),u.client_id&&e.jsxs("p",{className:F,children:["⚠️ ",u.client_id]})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Devise"}),e.jsx("select",{value:n.currency||"USD",onChange:l=>c({...n,currency:l.target.value}),className:z,children:Fe.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Statut"}),e.jsx("select",{value:n.status,onChange:l=>c({...n,status:l.target.value}),className:z,children:Te.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Date d’émission *"}),e.jsx("input",{type:"date",value:n.issue_date,onChange:l=>c({...n,issue_date:l.target.value}),className:`${y} ${u.issue_date?"border-red-300 dark:border-red-500":""}`}),u.issue_date&&e.jsxs("p",{className:F,children:["⚠️ ",u.issue_date]})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Échéance *"}),e.jsx("input",{type:"date",value:n.due_date,onChange:l=>c({...n,due_date:l.target.value}),className:`${y} ${u.due_date?"border-red-300 dark:border-red-500":""}`}),u.due_date&&e.jsxs("p",{className:F,children:["⚠️ ",u.due_date]})]})]})]}),R=e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(De,{className:"mr-2",size:20}),"Lignes"]}),e.jsxs("div",{className:"space-y-3",children:[f.map((l,i)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-[1fr_120px_140px_100px_90px] gap-3 items-start bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Description"}),e.jsx("input",{value:l.description,onChange:a=>$(i,{description:a.target.value}),placeholder:"Ex: Design landing page",className:y})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Qté"}),e.jsx("input",{type:"number",min:0,value:l.quantity,onChange:a=>$(i,{quantity:Number(a.target.value)}),className:y})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Prix unitaire"}),e.jsx("input",{type:"number",step:"0.01",min:0,value:l.unit_price,onChange:a=>$(i,{unit_price:Number(a.target.value)}),className:y})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Total"}),e.jsx("input",{disabled:!0,value:(Number(l.quantity||0)*Number(l.unit_price||0)).toFixed(2),className:`${y} opacity-70`})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>B(i),className:"p-2 rounded-lg border border-gray-300 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-800",title:"Monter",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>I(i),className:"p-2 rounded-lg border border-gray-300 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-800",title:"Descendre",children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:()=>E(i),className:"p-2 rounded-lg border border-red-200 dark:border-red-800 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",title:"Supprimer",children:e.jsx(le,{className:"w-4 h-4"})})]})]},i)),e.jsxs("button",{type:"button",onClick:A,className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-800",children:[e.jsx(de,{className:"w-4 h-4"}),"Ajouter une ligne"]}),u.items&&e.jsxs("p",{className:F,children:["⚠️ ",u.items]})]})]}),H=e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx(ge,{className:"mr-2",size:20}),"Totaux & taxes"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Sous-total"}),e.jsx("input",{disabled:!0,value:m.subtotal.toFixed(2),className:`${y} opacity-70`})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Remise (montant)"}),e.jsx("input",{type:"number",step:"0.01",min:0,value:n.discount,onChange:l=>c({...n,discount:Number(l.target.value)}),className:`${y} ${u.discount?"border-red-300 dark:border-red-500":""}`}),u.discount&&e.jsxs("p",{className:F,children:["⚠️ ",u.discount]})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"TVA %"}),e.jsx("input",{type:"number",step:"0.01",min:0,value:n.tax_rate,onChange:l=>c({...n,tax_rate:Number(l.target.value)}),className:`${y} ${u.tax_rate?"border-red-300 dark:border-red-500":""}`}),u.tax_rate&&e.jsxs("p",{className:F,children:["⚠️ ",u.tax_rate]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Montant TVA"}),e.jsx("input",{disabled:!0,value:m.tax_amount.toFixed(2),className:`${y} opacity-70`})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Remise appliquée"}),e.jsx("input",{disabled:!0,value:m.discount_amount.toFixed(2),className:`${y} opacity-70`})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Total"}),e.jsx("input",{disabled:!0,value:m.total.toFixed(2),className:`${y} opacity-70`})]})]})]}),K=l=>{if(l.key==="Enter"&&l.currentTarget.value.trim()){l.preventDefault();const i=l.currentTarget.value.trim();n.tags.includes(i)||c(a=>({...a,tags:[...a.tags,i]})),l.currentTarget.value=""}},Z=l=>c(i=>({...i,tags:i.tags.filter(a=>a!==l)})),W=e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4 flex items-center",children:[e.jsx($e,{className:"mr-2",size:20}),"Notes, conditions & tags"]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Notes"}),e.jsx("textarea",{rows:3,value:n.notes,onChange:l=>c({...n,notes:l.target.value}),className:y,placeholder:"Notes internes ou message au client…"})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Conditions"}),e.jsx("textarea",{rows:3,value:n.terms,onChange:l=>c({...n,terms:l.target.value}),className:y,placeholder:"Conditions de paiement, mentions légales…"})]}),e.jsxs("div",{children:[e.jsx("label",{className:p,children:"Tags"}),e.jsx("input",{type:"text",onKeyDown:K,className:y,placeholder:"Tapez un tag et Entrée"}),n.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:n.tags.map((l,i)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",children:[l,e.jsx("button",{type:"button",onClick:()=>Z(l),className:"ml-1 text-blue-600 hover:text-blue-800 dark:text-blue-300 dark:hover:text-blue-200",children:"×"})]},i))})]})]});return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg shadow-xl w-full max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:t?"Modifier la facture":"Créer / Envoyer une facture"}),e.jsx("div",{className:"flex items-center mt-2",children:[1,2,3,4].map(l=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${l<=g?"bg-blue-600 text-white":"bg-gray-200 text-gray-600 dark:bg-slate-700 dark:text-gray-300"}`,children:l}),l<4&&e.jsx("div",{className:`w-12 h-1 mx-2 ${l<g?"bg-blue-600":"bg-gray-200 dark:bg-slate-700"}`})]},l))})]}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(G,{size:24})})]}),e.jsxs("form",{onSubmit:X,className:"p-6 space-y-6",children:[g===1&&J,g===2&&R,g===3&&H,g===4&&W,e.jsxs("div",{className:"flex justify-between mt-2 pt-6 border-t border-gray-200 dark:border-slate-700",children:[e.jsx("button",{type:"button",onClick:U,disabled:g===1,className:"px-4 py-2 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Précédent"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors",disabled:b,children:"Annuler"}),g<4?e.jsx("button",{type:"button",onClick:D,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Suivant"}):e.jsx("button",{type:"submit",disabled:b,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),t?"Enregistrement…":"Création…"]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:16,className:"mr-2"}),t?"Mettre à jour":"Créer la facture"]})})]})]})]})]})})},M=(s,d="USD")=>{if(s==null||isNaN(s))return"—";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:d}).format(s)}catch{return`${s.toFixed(2)} ${d}`}},O=s=>{if(!s)return"—";const d=new Date(s);return isNaN(d.getTime())?"—":d.toLocaleDateString()},Ee=({isOpen:s,onClose:d,invoiceId:r,onSuccess:t})=>{const[b,N]=x.useState(!1),[g,h]=x.useState(""),[u,v]=x.useState(""),[w,_]=x.useState("card"),[f,k]=x.useState("");if(!s)return null;const n=async c=>{if(c.preventDefault(),!g||Number(g)<=0||!u){C.error("Montant et date requis");return}{C.success("Paiement (demo) ajouté"),t(),d();return}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Ajouter un paiement"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(G,{size:22})})]}),e.jsxs("form",{onSubmit:n,className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-300",children:"Montant *"}),e.jsx("input",{type:"number",step:"0.01",min:0,value:g,onChange:c=>h(c.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-300",children:"Date de paiement *"}),e.jsx("input",{type:"date",value:u,onChange:c=>v(c.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-300",children:"Méthode"}),e.jsxs("select",{value:w,onChange:c=>_(c.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"card",children:"Carte"}),e.jsx("option",{value:"bank_transfer",children:"Virement"}),e.jsx("option",{value:"cash",children:"Espèces"}),e.jsx("option",{value:"paypal",children:"PayPal"}),e.jsx("option",{value:"other",children:"Autre"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 text-gray-700 dark:text-gray-300",children:"Note"}),e.jsx("textarea",{value:f,onChange:c=>k(c.target.value),rows:3,className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Référence, commentaire…"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-slate-700",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-slate-700 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-slate-800",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:b,className:"px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 flex items-center",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Enregistrement…"]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Valider"]})})]})]})]})})},q=s=>s==null?"0.00":Number(s).toFixed(2),ae=s=>s==null?"—":String(s);async function ue(s){var n;const d=new we({unit:"pt",format:"a4"}),r=48;let t=r;const b=(s==null?void 0:s.currency)||"USD";d.setFont("helvetica","bold"),d.setFontSize(18),d.text("INVOICE",r,t),t+=26,d.setFontSize(11),d.setFont("helvetica","normal"),d.text(`Invoice #: ${ae(s==null?void 0:s.number)}`,r,t),t+=16,d.text(`Issue date: ${s!=null&&s.issue_date?new Date(s.issue_date).toLocaleDateString():"—"}`,r,t),t+=16,d.text(`Due date: ${s!=null&&s.due_date?new Date(s.due_date).toLocaleDateString():"—"}`,r,t),t+=28,d.setFont("helvetica","bold"),d.text("Billed to:",r,t),d.setFont("helvetica","normal"),t+=16,d.text(ae((n=s==null?void 0:s.clients)==null?void 0:n.name),r,t),t+=32,d.setFont("helvetica","bold"),d.text("Items",r,t),t+=14,d.setFontSize(10);const N=r,g=340,h=400,u=480;d.text("Description",N,t),d.text("Qty",g,t),d.text("Unit",h,t),d.text("Total",u,t),t+=10,d.setDrawColor(200),d.line(r,t,548,t),d.setFont("helvetica","normal"),t+=16,((s==null?void 0:s.items)||[]).forEach(c=>{t>720&&(d.addPage(),t=r);const m=c.line_total!=null?c.line_total:Number(c.quantity)*Number(c.unit_price),S=d.splitTextToSize(c.description||"—",g-N-12);d.text(S,N,t),d.text(String(c.quantity??0),g,t),d.text(q(c.unit_price),h,t),d.text(q(m),u,t,{align:"left"});const D=Array.isArray(S)?S.length*12:12;t+=Math.max(16,D+4)}),t+=10,t>720&&(d.addPage(),t=r),d.setDrawColor(200),d.line(r,t,548,t),t+=16;const w=400,_=548;d.text("Subtotal:",w,t,{align:"left"}),d.text(`${q(s==null?void 0:s.subtotal)} ${b}`,_,t,{align:"right"}),t+=16,d.text("Discount:",w,t,{align:"left"}),d.text(`${q(s==null?void 0:s.discount)} ${b}`,_,t,{align:"right"}),t+=16;const f=Number((s==null?void 0:s.tax_rate)||0),k=(s==null?void 0:s.tax_amount)??(Number((s==null?void 0:s.subtotal)||0)-Number((s==null?void 0:s.discount)||0))*f/100;return d.text(`Tax (${q(f)}%):`,w,t,{align:"left"}),d.text(`${q(k)} ${b}`,_,t,{align:"right"}),t+=16,d.setFont("helvetica","bold"),d.text("TOTAL:",w,t,{align:"left"}),d.text(`${q(s==null?void 0:s.total)} ${b}`,_,t,{align:"right"}),t+=36,d.setFont("helvetica","normal"),d.setFontSize(9),d.setTextColor(120),d.text("Thank you for your business.",r,t),d}async function Ie(s){const d=await ue(s),r=`${(s==null?void 0:s.number)||"invoice"}.pdf`;d.save(r)}async function qe(s){return(await ue(s)).output("datauristring").split(",")[1]}const Me=({isOpen:s,onClose:d,invoice:r})=>{const[t,b]=x.useState(""),[N,g]=x.useState(""),[h,u]=x.useState(""),[v,w]=x.useState(!1);if(x.useMemo(()=>{var c,m,S;if(!s||!r)return;const n=((c=r==null?void 0:r.clients)==null?void 0:c.email_primary)||((m=r==null?void 0:r.clients)==null?void 0:m.email)||"";b(n||""),g(`Facture ${(r==null?void 0:r.number)||""}`),u(`Bonjour ${((S=r==null?void 0:r.clients)==null?void 0:S.name)||""},

Veuillez trouver ci-joint votre facture ${(r==null?void 0:r.number)||""}.

Cordialement,
FiverFlow`)},[s,r]),!s)return null;const _=async n=>{if(n.preventDefault(),!t||!N){C.error("Destinataire et sujet requis");return}try{w(!0);const c=C.loading("Génération du PDF…"),m=await qe(r),S=`${(r==null?void 0:r.number)||"invoice"}.pdf`;if(C.loading("Envoi de l'email…",{id:c}),!ie||!Q){await new Promise(A=>setTimeout(A,800)),C.success("Email envoyé (demo)",{id:c}),d();return}const{data:D,error:U}=await Q.functions.invoke("send-invoice-email",{body:{to:t,subject:N,html:h.replace(/\n/g,"<br/>"),pdfBase64:m,filename:S}});if(U)throw U;if(D!=null&&D.error)throw new Error(D.error);C.success("Email envoyé",{id:c}),d()}catch(c){console.error("[EmailInvoiceModal] send error:",c),C.error("Échec de l'envoi")}finally{w(!1)}},f="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent border-gray-300 text-gray-900 placeholder-gray-400 dark:bg-slate-800 dark:border-slate-700 dark:text-white dark:placeholder-slate-400",k="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300";return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg shadow-xl w-full max-w-lg",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Envoyer la facture par email"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(G,{size:22})})]}),e.jsxs("form",{onSubmit:_,className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Destinataire *"}),e.jsx("input",{value:t,onChange:n=>b(n.target.value),type:"email",className:f,placeholder:"client@email.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Sujet *"}),e.jsx("input",{value:N,onChange:n=>g(n.target.value),className:f})]}),e.jsxs("div",{children:[e.jsx("label",{className:k,children:"Message"}),e.jsx("textarea",{value:h,onChange:n=>u(n.target.value),rows:6,className:f})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-slate-700",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-slate-700 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-slate-800",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:v,className:"px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 inline-flex items-center",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Envoi…"]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Envoyer"]})})]})]})]})})},Pe=({isOpen:s,onClose:d,invoice:r,loading:t=!1,onEdit:b,onRefetch:N})=>{var c;const[g,h]=x.useState(!1),[u,v]=x.useState(!1),[w,_]=x.useState(null);if(!s)return null;const f=async m=>{if(r!=null&&r.id){C.success(`Statut changé (${m}) [demo]`),N==null||N();return}},k=async()=>{try{await Ie(r)}catch(m){console.error("[InvoiceView] pdf error:",m),C.error("Génération PDF impossible")}},n=(r==null?void 0:r.payments)||[];return e.jsxs("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Aperçu de la facture"}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(G,{size:22})})]}),t?e.jsxs("div",{className:"p-10 flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-7 w-7 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Chargement…"})]}):r?e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Numéro"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.number||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Client"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:((c=r.clients)==null?void 0:c.name)||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Émise le"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:O(r.issue_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Échéance"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:O(r.due_date)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Statut"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.status||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total"}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:M(r.total,r.currency||"USD")})]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-slate-700",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-slate-700 font-medium text-gray-900 dark:text-gray-100",children:"Lignes"}),e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:(r.items||[]).length===0?e.jsx("div",{className:"p-4 text-gray-600 dark:text-gray-300",children:"Aucune ligne"}):r.items.map((m,S)=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-6 gap-2 p-4",children:[e.jsx("div",{className:"sm:col-span-3 text-gray-900 dark:text-gray-100",children:m.description}),e.jsxs("div",{className:"text-gray-600 dark:text-gray-300",children:["Qté: ",m.quantity]}),e.jsxs("div",{className:"text-gray-600 dark:text-gray-300",children:["PU: ",Number(m.unit_price).toFixed(2)]}),e.jsx("div",{className:"text-gray-900 dark:text-gray-100 font-medium text-right",children:Number(m.line_total??m.quantity*m.unit_price).toFixed(2)})]},S))}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-slate-700 grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sous‑total"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 text-right",children:M(r.subtotal,r.currency||"USD")}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Remise"}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 text-right",children:M(r.discount,r.currency||"USD")}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["TVA (",r.tax_rate??0,"%)"]}),e.jsx("div",{className:"text-sm text-gray-900 dark:text-gray-100 text-right",children:M(r.tax_amount??(r.subtotal-(r.discount||0))*(Number(r.tax_rate||0)/100),r.currency||"USD")}),e.jsx("div",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Total"}),e.jsx("div",{className:"text-base font-semibold text-gray-900 dark:text-gray-100 text-right",children:M(r.total,r.currency||"USD")})]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-slate-700 flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Paiements"}),e.jsxs("button",{onClick:()=>h(!0),className:"inline-flex items-center px-3 py-1.5 rounded-lg bg-blue-600 text-white hover:bg-blue-700",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Ajouter un paiement"]})]}),(n||[]).length===0?e.jsx("div",{className:"p-4 text-gray-600 dark:text-gray-300",children:"Aucun paiement enregistré"}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:n.map(m=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-2 p-4",children:[e.jsx("div",{className:"text-gray-900 dark:text-gray-100",children:M(m.amount,r.currency||"USD")}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:O(m.paid_at)}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:m.method||"—"}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:m.note||"—"})]},m.id))})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-2 pt-2",children:[e.jsxs("button",{onClick:k,className:"inline-flex items-center px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-800 text-gray-700 dark:text-gray-200",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Télécharger PDF"]}),e.jsxs("button",{onClick:()=>v(!0),className:"inline-flex items-center px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700",children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Envoyer par email"]}),b&&e.jsxs("button",{onClick:()=>b(r),className:"inline-flex items-center px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-800 text-gray-700 dark:text-gray-200",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Modifier"]}),e.jsxs("button",{onClick:()=>f("sent"),disabled:w!==null,className:"inline-flex items-center px-3 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-50",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Marquer envoyé"]}),e.jsxs("button",{onClick:()=>f("paid"),disabled:w!==null,className:"inline-flex items-center px-3 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 disabled:opacity-50",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Marquer payé"]})]})]}):e.jsx("div",{className:"p-6 text-gray-600 dark:text-gray-300",children:"Aucune donnée."})]}),e.jsx(Ee,{isOpen:g,onClose:()=>h(!1),invoiceId:r==null?void 0:r.id,onSuccess:N||(()=>{})}),e.jsx(Me,{isOpen:u,onClose:()=>v(!1),invoice:r})]})},Ue=["draft","sent","paid","overdue","canceled"],Ve=()=>{var i;const s=ye(),d=pe(),{user:r}=se(),{restrictions:t,checkAccess:b}=je(),[N,g]=x.useState(!0),[h,u]=x.useState([]),[v,w]=x.useState(""),[_,f]=x.useState(""),[k,n]=x.useState(!1),[c,m]=x.useState(null),[S,D]=x.useState(!1),[U,A]=x.useState(!1),[E,B]=x.useState(null),I=!!(t!=null&&t.isAdmin||b("invoices")),$=x.useCallback(a=>s.pathname===a,[s.pathname]),X=x.useCallback(a=>d(a),[d]),y=x.useCallback(async()=>{if(!r){u([]),g(!1);return}if(!I){u([]),g(!1);return}{const a=Array.from({length:12}).map((o,j)=>({id:String(j+1),number:`INV-2025-${String(j+1).padStart(4,"0")}`,client_id:"demo",status:["draft","sent","paid","overdue"][j%4],currency:"USD",issue_date:new Date().toISOString(),due_date:new Date(Date.now()+6048e5).toISOString(),subtotal:100+j*25,discount:j%3===0?10:0,tax_rate:20,total:100+j*25+18,clients:{id:"c",name:j%2?"Acme Inc":"John Doe",platform:j%2?"Fiverr":"Upwork"}}));u(a),g(!1);return}},[r,I,v,_]);x.useEffect(()=>{y()},[y]),x.useEffect(()=>{$("/invoices/create")&&(m(null),n(!0))},[$]);const z=x.useCallback(async a=>{if(a){D(!0),A(!0),B(null);{const o=h.find(me=>me.id===a);if(!o){A(!1),C.error("Facture introuvable (démo).");return}const j=(Number((o==null?void 0:o.subtotal)??0)-Number((o==null?void 0:o.discount)??0))*(Number((o==null?void 0:o.tax_rate)??0)/100),T={...o,items:[{description:"Design landing",quantity:1,unit_price:350,line_total:350},{description:"Intégration",quantity:4,unit_price:80,line_total:320}],payments:[],tax_amount:j};B(T),A(!1);return}}},[h]),p=x.useCallback(a=>{m({id:a.id,number:a.number||"",client_id:a.client_id,currency:a.currency||"USD",issue_date:a.issue_date||"",due_date:a.due_date||"",status:a.status,subtotal:a.subtotal,tax_rate:a.tax_rate,discount:a.discount,total:a.total,notes:null,terms:null,tags:[]}),n(!0)},[]),F=x.useCallback(async(a,o)=>{{C.success(`Statut changé (${o}) [demo]`),u(j=>j.map(T=>T.id===a.id?{...T,status:o}:T));return}},[y]),J=x.useCallback(async a=>{if(confirm("Supprimer cette facture ?")){C.success("Supprimée (demo)"),u(o=>o.filter(j=>j.id!==a.id));return}},[]),R=x.useMemo(()=>{let a=h;{const o=v.trim().toLowerCase();o&&(a=a.filter(j=>{var T;return(j.number||"").toLowerCase().includes(o)||(((T=j.clients)==null?void 0:T.name)||"").toLowerCase().includes(o)})),_&&(a=a.filter(j=>j.status===_))}return $("/invoices/sent")&&(a=a.filter(o=>o.status==="sent")),a},[h,v,_,$]),H=(a,o)=>M(Number(a??0),o||"USD"),K=e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Factures"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Créer, envoyer et suivre vos factures."})]}),e.jsxs("button",{onClick:()=>{m(null),n(!0),X("/invoices/create")},className:`inline-flex items-center px-4 py-2 rounded-lg ${I?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"}`,disabled:!I,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Créer / Envoyer"]})]}),Z=e.jsxs("div",{className:`${L} p-3 sm:p-4`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-gray-700 dark:text-gray-200",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Filtres"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{value:v,onChange:a=>w(a.target.value),placeholder:"Rechercher (numéro, client)…",className:`w-full pl-9 pr-9 py-2 rounded-lg border border-gray-300 dark:border-slate-700
                       bg-white dark:bg-slate-900 text-gray-900 dark:text-gray-100
                       placeholder-gray-400 dark:placeholder-slate-400
                       focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent`,type:"text"})]}),e.jsxs("select",{value:_,onChange:a=>f(a.target.value),className:"px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Statut (tous)"}),Ue.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx("button",{onClick:()=>{w(""),f("")},className:"px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-800 text-gray-700 dark:text-gray-200",children:"Réinitialiser"})]})]}),W=e.jsx("div",{className:`${L}`,children:N?e.jsxs("div",{className:"p-10 flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-7 w-7 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Chargement…"})]}):R.length===0?e.jsxs("div",{className:"p-10 text-center",children:[e.jsx(re,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-slate-100",children:"Aucune facture"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-slate-400",children:"Créez votre première facture pour commencer."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-slate-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300",children:"N°"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300",children:"Client"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300",children:"Émise le"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300",children:"Échéance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-300",children:"Total"}),e.jsx("th",{className:"px-6 py-3"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-slate-700",children:R.map(a=>{var o;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800/40",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:[e.jsx("div",{className:"font-medium",children:a.number||"—"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.status})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200",children:((o=a.clients)==null?void 0:o.name)||"—"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200",children:O(a.issue_date??void 0)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-200",children:O(a.due_date??void 0)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100",children:H(a.total,a.currency)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>z(a.id),className:"inline-flex items-center px-2.5 py-1.5 rounded-lg border border-gray-300 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-800 text-gray-700 dark:text-gray-200",title:"Voir",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(a),className:"inline-flex items-center px-2.5 py-1.5 rounded-lg border border-gray-300 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-800 text-gray-700 dark:text-gray-200",title:"Modifier",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>F(a,"sent"),className:"inline-flex items-center px-2.5 py-1.5 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700",title:"Marquer envoyé",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>F(a,"paid"),className:"inline-flex items-center px-2.5 py-1.5 rounded-lg bg-green-600 text-white hover:bg-green-700",title:"Marquer payé",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>J(a),className:"inline-flex items-center px-2.5 py-1.5 rounded-lg border border-red-200 dark:border-red-800 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",title:"Supprimer",children:e.jsx(le,{className:"w-4 h-4"})})]})})]},a.id)})})]})})}),l=e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:`${L} p-4`,children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Total émis"}),e.jsx("div",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:H(h.reduce((a,o)=>a+Number(o.total??0),0),((i=h[0])==null?void 0:i.currency)||"USD")})]}),e.jsxs("div",{className:`${L} p-4`,children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Envoyées"}),e.jsx("div",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:h.filter(a=>a.status==="sent").length})]}),e.jsxs("div",{className:`${L} p-4`,children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Payées"}),e.jsx("div",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:h.filter(a=>a.status==="paid").length})]})]});return e.jsxs("div",{className:"space-y-6 p-4 sm:p-0",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:K}),I?e.jsxs(e.Fragment,{children:[$("/invoices")&&l,Z,W]}):e.jsxs("div",{className:`${L} p-6 text-center`,children:[e.jsx("h2",{className:"text-xl font-semibold mb-2 text-gray-900 dark:text-white",children:"Accès restreint"}),e.jsxs("p",{className:"mb-4 text-gray-700 dark:text-gray-300",children:["Cette section est réservée aux utilisateurs ",e.jsx("strong",{children:"Excellence"})," ou aux administrateurs."]}),e.jsx(Ne,{to:"/upgrade",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Passer à Excellence"})]}),e.jsx(Pe,{isOpen:S,onClose:()=>D(!1),invoice:E,loading:U,onEdit:a=>{D(!1),m(a),n(!0)},onRefetch:()=>(E==null?void 0:E.id)&&z(E.id)}),e.jsx(Ae,{isOpen:k,onClose:()=>{n(!1),$("/invoices/create")&&d("/invoices")},onSuccess:()=>{y()},invoice:c})]})};export{Ve as default};
