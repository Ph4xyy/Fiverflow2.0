import{r as b}from"./index-D6LT2v2_.js";import{E as Q}from"./jspdf.es.min-B8RMXKW2.js";function C(){return{style:{primaryColor:"#2563eb",secondaryColor:"#111827",fontFamily:"helvetica",logoUrl:null,logoWidth:120,pageSize:"A4",margin:48,tableStripe:!0},sections:{header:{visible:!0,label:"INVOICE"},sellerInfo:{visible:!0},clientInfo:{visible:!0,label:"Billed to:"},items:{visible:!0,label:"Items"},totals:{visible:!0},notes:{visible:!0,label:"Notes"},footer:{visible:!0,label:"Thank you for your business."}},labels:{invoiceTitle:"INVOICE",invoiceNumber:"Invoice #",issueDate:"Issue date",dueDate:"Due date",billedTo:"Billed to:",items:"Items",qty:"Qty",unitPrice:"Unit",lineTotal:"Total",subtotal:"Subtotal",discount:"Discount",tax:"Tax",total:"TOTAL",notes:"Notes"},variables:["{{company.name}}","{{company.logoUrl}}","{{client.name}}","{{invoice.number}}","{{invoice.date}}","{{invoice.due_date}}","{{lineItems[i].description}}","{{totals.subtotal}}","{{totals.total}}"]}}const v=i=>i==null||Number.isNaN(Number(i))?"0.00":Number(i).toFixed(2);async function H(i,o){var g,I,c,m,S,p,F,T,s,n,a,r,D,$,N,w,O,k,z,A,E,L,P,U,q;const l=i.style.margin??48,e=new Q({unit:"pt",format:(i.style.pageSize||"A4").toLowerCase()});let t=l;if(e.setFont(i.style.fontFamily||"helvetica","bold"),e.setTextColor(i.style.secondaryColor||"#111827"),e.setDrawColor(200),((g=i.sections.header)==null?void 0:g.visible)!==!1&&(e.setFontSize(20),e.text(((I=i.labels)==null?void 0:I.invoiceTitle)||"INVOICE",l,t),t+=26),((c=i.sections.sellerInfo)==null?void 0:c.visible)!==!1&&(e.setFontSize(11),e.setFont(i.style.fontFamily||"helvetica","normal"),i.style.logoUrl,e.text(String(((m=o.company)==null?void 0:m.name)||"Your Company"),l,t)),((S=i.sections.clientInfo)==null?void 0:S.visible)!==!1&&(e.setFont(i.style.fontFamily||"helvetica","bold"),e.text(((p=i.labels)==null?void 0:p.billedTo)||"Billed to:",300,t),e.setFont(i.style.fontFamily||"helvetica","normal"),t+=16,e.text(String(((F=o.client)==null?void 0:F.name)||"Client"),300,t)),t+=14,e.setFont(i.style.fontFamily||"helvetica","normal"),e.text(`${((T=i.labels)==null?void 0:T.invoiceNumber)||"Invoice #"}: ${o.invoice.number||"—"}`,l,t),t+=14,e.text(`${((s=i.labels)==null?void 0:s.issueDate)||"Issue date"}: ${o.invoice.issue_date?new Date(o.invoice.issue_date).toLocaleDateString():"—"}`,l,t),t+=14,e.text(`${((n=i.labels)==null?void 0:n.dueDate)||"Due date"}: ${o.invoice.due_date?new Date(o.invoice.due_date).toLocaleDateString():"—"}`,l,t),((a=i.sections.items)==null?void 0:a.visible)!==!1){t+=28,e.setFont(i.style.fontFamily||"helvetica","bold"),e.text(((r=i.labels)==null?void 0:r.items)||"Items",l,t),t+=14;const u=l,f=340,y=400,x=480;e.setFontSize(10),e.text(((D=i.labels)==null?void 0:D.items)||"Description",u,t),e.text((($=i.labels)==null?void 0:$.qty)||"Qty",f,t),e.text(((N=i.labels)==null?void 0:N.unitPrice)||"Unit",y,t),e.text(((w=i.labels)==null?void 0:w.lineTotal)||"Total",x,t),t+=10,e.line(l,t,548,t),t+=16,e.setFont(i.style.fontFamily||"helvetica","normal"),(o.invoice.items||[]).forEach((d,V)=>{t>720&&(e.addPage(),t=l);const _=e.splitTextToSize(d.description||"—",f-u-12),X=d.line_total??d.quantity*d.unit_price;i.style.tableStripe&&V%2===1&&(e.setFillColor(245),e.rect(l-4,t-10,548-l,22,"F")),e.text(_,u,t),e.text(String(d.quantity??0),f,t),e.text(v(d.unit_price),y,t),e.text(v(X),x,t);const B=Array.isArray(_)?_.length*12:12;t+=Math.max(16,B+4)})}if(((O=i.sections.totals)==null?void 0:O.visible)!==!1){t+=10,t>720&&(e.addPage(),t=l),e.line(l,t,548,t),t+=16;const u=400,f=548,y=o.invoice.currency||"USD";e.text((((k=i.labels)==null?void 0:k.subtotal)||"Subtotal")+":",u,t),e.text(`${v(o.invoice.subtotal)} ${y}`,f,t,{align:"right"}),t+=16,e.text((((z=i.labels)==null?void 0:z.discount)||"Discount")+":",u,t),e.text(`${v(o.invoice.discount)} ${y}`,f,t,{align:"right"}),t+=16;const x=Number(o.invoice.tax_rate||0),d=o.invoice.tax_amount??(Number(o.invoice.subtotal||0)-Number(o.invoice.discount||0))*x/100;e.text(`${((A=i.labels)==null?void 0:A.tax)||"Tax"} (${v(x)}%):`,u,t),e.text(`${v(d)} ${y}`,f,t,{align:"right"}),t+=16,e.setFont(i.style.fontFamily||"helvetica","bold"),e.text((((E=i.labels)==null?void 0:E.total)||"TOTAL")+":",u,t),e.text(`${v(o.invoice.total)} ${y}`,f,t,{align:"right"})}if(((L=i.sections.notes)==null?void 0:L.visible)!==!1&&o.invoice.notes){t+=28,e.setFont(i.style.fontFamily||"helvetica","bold"),e.text(((P=i.labels)==null?void 0:P.notes)||"Notes",l,t),t+=14,e.setFont(i.style.fontFamily||"helvetica","normal");const u=e.splitTextToSize(String(o.invoice.notes||""),548-l);e.text(u,l,t)}return((U=i.sections.footer)==null?void 0:U.visible)!==!1&&(t+=32,e.setFontSize(9),e.setTextColor(120),e.setFont(i.style.fontFamily||"helvetica","normal"),e.text(String(((q=i.labels)==null?void 0:q.footer)||"Thank you for your business."),l,t)),e}function Y(i){const[o,l]=b.useState(!0),[e,t]=b.useState([]),[g,I]=b.useState(null),c=b.useCallback(async()=>{if(!i){t([]),l(!1);return}{const s=[{id:"demo-1",user_id:"demo",name:"Minimal",is_default:!0,schema:C(),variables:C().variables||[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()}];t(s),l(!1);return}},[i]);b.useEffect(()=>{c()},[c]);const m=b.useCallback(async s=>{const n=C();{const a=`demo-${Date.now()}`;return t(r=>[{id:a,user_id:"demo",name:s,is_default:r.length===0,schema:n,variables:n.variables||[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()},...r]),{id:a}}},[i,e.length,c]),S=b.useCallback(async(s,n)=>{{t(a=>a.map(r=>r.id===s?{...r,...n}:r));return}},[c]),p=b.useCallback(async s=>{{t(n=>n.filter(a=>a.id!==s));return}},[c]),F=b.useCallback(async s=>{const n=e.find(r=>r.id===s);if(!n)return;const a=`${n.name} (copy)`;{const r=`demo-${Date.now()}`;t(D=>[{...n,id:r,name:a,is_default:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},...D]);return}},[e,i,c]),T=b.useCallback(async s=>{{t(n=>n.map(a=>({...a,is_default:a.id===s})));return}},[i,c]);return{loading:o,items:e,error:g,fetchAll:c,create:m,update:S,remove:p,duplicate:F,setDefault:T}}export{H as r,Y as u};
