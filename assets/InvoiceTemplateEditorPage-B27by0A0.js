import{j as e,r as x,s as j,V as h,o as k,a as w,b as C}from"./index-D6LT2v2_.js";import{u as S,r as T}from"./useInvoiceTemplates-Dz5JZRs8.js";import"./jspdf.es.min-B8RMXKW2.js";const y=({label:r,children:a})=>e.jsxs("label",{className:"block text-sm mb-3",children:[e.jsx("span",{className:"block text-gray-600 dark:text-gray-300 mb-1",children:r}),a]}),N=({label:r,checked:a,onChange:t})=>e.jsxs("label",{className:"flex items-center justify-between text-sm py-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:r}),e.jsx("input",{type:"checkbox",checked:a,onChange:s=>t(s.target.checked),className:"h-4 w-4"})]}),U=({value:r,onChange:a})=>{const t=r.style;return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Style"}),e.jsx(y,{label:"Couleur primaire",children:e.jsx("input",{type:"color",value:t.primaryColor,onChange:s=>a({...r,style:{...t,primaryColor:s.target.value}}),className:"h-9 w-14 p-0 border border-gray-300 dark:border-slate-700 rounded"})}),e.jsx(y,{label:"Couleur secondaire",children:e.jsx("input",{type:"color",value:t.secondaryColor,onChange:s=>a({...r,style:{...t,secondaryColor:s.target.value}}),className:"h-9 w-14 p-0 border border-gray-300 dark:border-slate-700 rounded"})}),e.jsx(y,{label:"Police",children:e.jsxs("select",{value:t.fontFamily,onChange:s=>a({...r,style:{...t,fontFamily:s.target.value}}),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900",children:[e.jsx("option",{value:"helvetica",children:"Helvetica"}),e.jsx("option",{value:"times",children:"Times"}),e.jsx("option",{value:"courier",children:"Courier"})]})}),e.jsx(y,{label:"Marge (px)",children:e.jsx("input",{type:"number",value:t.margin??48,onChange:s=>a({...r,style:{...t,margin:Number(s.target.value||48)}}),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900"})}),e.jsx(y,{label:"Largeur logo (px)",children:e.jsx("input",{type:"number",value:t.logoWidth??120,onChange:s=>a({...r,style:{...t,logoWidth:Number(s.target.value||120)}}),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900"})}),e.jsx(N,{label:"Bandes alternées tableau",checked:!!t.tableStripe,onChange:s=>a({...r,style:{...t,tableStripe:s}})}),e.jsxs("div",{className:"pt-2 border-t border-gray-200 dark:border-slate-700",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Sections"}),Object.entries(r.sections).map(([s,n])=>e.jsx(N,{label:`Afficher "${s}"`,checked:(n==null?void 0:n.visible)!==!1,onChange:l=>a({...r,sections:{...r.sections,[s]:{...n||{},visible:l}}})},s))]})]})},P=({path:r,alt:a="Logo",className:t,ttl:s=3600})=>{const[n,l]=x.useState(null),d=x.useRef(null),o=x.useRef(!0),i=async()=>{if(o.current){if(!r){l(null);return}{l(null);return}}};x.useEffect(()=>{if(o.current=!0,i(),d.current&&clearTimeout(d.current),r){const u=Math.max((s-300)*1e3,3e4);d.current=setTimeout(i,u)}return()=>{o.current=!1,d.current&&clearTimeout(d.current)}},[r,s]);const m=()=>i();return n?e.jsx("img",{src:n,alt:a,className:t,onError:m}):null},E=({value:r})=>{var l,d,o,i,m,u,g,c;const a=((l=r==null?void 0:r.assets)==null?void 0:l.logo_path)||(r==null?void 0:r.logo_path)||((d=r==null?void 0:r.brand)==null?void 0:d.logo_path)||null,t=((o=r==null?void 0:r.style)==null?void 0:o.primaryColor)||"#e5e7eb",s=((i=r==null?void 0:r.style)==null?void 0:i.secondaryColor)||"#111827",n=((m=r==null?void 0:r.style)==null?void 0:m.fontFamily)||"inherit";return e.jsxs("div",{className:"w-full bg-white dark:bg-slate-900 rounded-lg border border-gray-200 dark:border-slate-700 p-6",style:{fontFamily:n},children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Aperçu (maquette)"}),e.jsxs("div",{className:"rounded-lg border border-dashed p-6",style:{borderColor:t},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[a?e.jsx(P,{path:a,className:"h-10 w-auto object-contain",alt:"Logo société"},a||"no-logo"):e.jsx("div",{className:"h-10 w-10 rounded bg-gray-100 dark:bg-slate-800"}),e.jsx("div",{className:"text-2xl font-semibold",style:{color:s},children:((u=r.labels)==null?void 0:u.invoiceTitle)||"INVOICE"})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("div",{children:"N° — INV‑XXXX"}),e.jsx("div",{children:"Date — AAAA‑MM‑JJ"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Votre entreprise"}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Adresse · Ville · Pays"}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Email · Téléphone"})]}),e.jsxs("div",{className:"sm:text-right",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Client"}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Nom du client"}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Email · Référence"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("div",{className:"text-sm font-medium mb-2",style:{color:s},children:((g=r.labels)==null?void 0:g.items)||"Items"}),e.jsxs("div",{className:"rounded border border-gray-200 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-12 bg-gray-50 dark:bg-slate-800 text-xs font-medium text-gray-700 dark:text-gray-300",children:[e.jsx("div",{className:"col-span-7 p-2",children:"Description"}),e.jsx("div",{className:"col-span-2 p-2 text-right",children:"Qté"}),e.jsx("div",{className:"col-span-1 p-2 text-right",children:"PU"}),e.jsx("div",{className:"col-span-2 p-2 text-right",children:"Total"})]}),[1,2,3].map(b=>e.jsxs("div",{className:"grid grid-cols-12 text-sm text-gray-900 dark:text-gray-100 border-t border-gray-200 dark:border-slate-700",children:[e.jsxs("div",{className:"col-span-7 p-2",children:["Ligne de service #",b]}),e.jsx("div",{className:"col-span-2 p-2 text-right",children:"1"}),e.jsx("div",{className:"col-span-1 p-2 text-right",children:"100.00"}),e.jsx("div",{className:"col-span-2 p-2 text-right",children:"100.00"})]},b))]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[((c=r.labels)==null?void 0:c.notes)||"Notes"," : Lorem ipsum dolor sit amet."]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Sous‑total"}),e.jsx("div",{className:"text-gray-900 dark:text-gray-100",children:"300.00"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Remise"}),e.jsx("div",{className:"text-gray-900 dark:text-gray-100",children:"0.00"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"TVA"}),e.jsx("div",{className:"text-gray-900 dark:text-gray-100",children:"0.00"})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-slate-700 mt-2 pt-2 flex items-center justify-between font-semibold",children:[e.jsx("div",{className:"text-gray-900 dark:text-gray-100",children:"Total"}),e.jsx("div",{className:"text-gray-900 dark:text-gray-100",children:"300.00"})]})]})]})]})]})};async function D(r,a=60*60){if(!r)return null;const{data:t}=j.storage.from("invoice-assets").getPublicUrl(r);if(t!=null&&t.publicUrl)return t.publicUrl;const{data:s,error:n}=await j.storage.from("invoice-assets").createSignedUrl(r,a);return n||!(s!=null&&s.signedUrl)?null:s.signedUrl}const I=({path:r,onChange:a,maxSizeMB:t=5})=>{const[s,n]=x.useState(!1),[l,d]=x.useState(null),o=x.useRef(null),i=()=>{o.current&&(o.current.value="")};x.useEffect(()=>{let g=!0;return(async()=>{if(!r){d(null);return}const c=await D(r);g&&d(c)})(),()=>{g=!1}},[r]);const m=async g=>{var p;const b=(p=g.currentTarget.files)==null?void 0:p[0];if(!b)return;const f=t*1024*1024;if(b.size>f){h.error(`Fichier trop lourd (max ${t} Mo).`),i();return}{const v=URL.createObjectURL(b);d(v),a(null),h.success("Logo défini (demo)"),i();return}},u=async()=>{{d(null),a(null);return}};return e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300 mb-2",children:"Logo"}),l?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:l,alt:"logo",className:"h-10 object-contain"}),e.jsx("button",{type:"button",onClick:u,className:"px-2 py-1.5 rounded border border-gray-300 dark:border-slate-700 text-sm",disabled:s,children:"Retirer"})]}):e.jsx("input",{ref:o,type:"file",accept:"image/png,image/jpeg,image/webp,image/svg+xml",onChange:m,disabled:s})]})},L={company:{name:"FiverFlow",logoUrl:"",address:""},client:{name:"John Doe",email:"john@doe.com",address:"Somewhere"},invoice:{number:"INV-2025-0001",currency:"USD",issue_date:new Date().toISOString(),due_date:new Date(Date.now()+7*864e5).toISOString(),items:[{description:"Design",quantity:1,unit_price:350,line_total:350},{description:"Development",quantity:10,unit_price:60,line_total:600}],subtotal:950,discount:0,tax_rate:20,tax_amount:190,total:1140,notes:"Payment due in 7 days."}},A=()=>{const{id:r}=k(),a=w(),{user:t}=C(),{items:s,update:n}=S(t==null?void 0:t.id),l=x.useMemo(()=>s.find(c=>c.id===r),[s,r]),[d,o]=x.useState((l==null?void 0:l.name)||""),[i,m]=x.useState(l==null?void 0:l.schema);if(x.useEffect(()=>{l&&(o(l.name),m(l.schema))},[l]),!l||!i)return e.jsx("div",{className:"p-6 rounded-xl border border-gray-200 dark:border-slate-700",children:e.jsx("div",{className:"text-gray-700 dark:text-gray-200",children:"Template introuvable."})});const u=async()=>{await n(l.id,{name:d,schema:i}),h.success("Modèle enregistré")},g=async()=>{(await T(i,L)).save(`${d||"template"}.pdf`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Éditeur de template"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Personnalisez votre modèle de facture."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a("/invoices/templates"),className:"px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700",children:"Retour"}),e.jsx("button",{onClick:u,className:"px-3 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700",children:"Enregistrer"}),e.jsx("button",{onClick:g,className:"px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700",children:"Export PDF test"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[340px_1fr] gap-6",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700",children:[e.jsx("label",{className:"block text-sm text-gray-700 dark:text-gray-300 mb-1",children:"Nom du template"}),e.jsx("input",{value:d,onChange:c=>o(c.target.value),className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900"})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700",children:e.jsx(I,{value:i.style.logoUrl||null,onChange:c=>m({...i,style:{...i.style,logoUrl:c||void 0}})})}),e.jsx(U,{value:i,onChange:m})]}),e.jsx(E,{value:i})]})]})};export{A as default};
